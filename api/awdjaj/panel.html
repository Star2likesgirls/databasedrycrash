<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(0, 255, 136, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 255, 136, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(0, 255, 136, 0.03) 0%, transparent 50%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
        }

        .logo {
            background: #00ff88;
            color: #000;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 24px;
            font-weight: 900;
            display: inline-block;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .title {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #ffffff, #00ff88);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #888;
            margin-bottom: 10px;
        }

        .tagline {
            font-size: 1rem;
            color: #00ff88;
            font-weight: 500;
        }

        .editor-section, .stats-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }

        .editor-section {
            flex: 1;
        }

        .section-title {
            font-size: 1.5rem;
            color: #00ff88;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .file-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            background: #00cc6a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .text-editor {
            width: 100%;
            min-height: 400px;
            background: #1a1a1a;
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', Monaco, monospace;
            font-size: 14px;
            color: #ffffff;
            resize: vertical;
            line-height: 1.6;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .text-editor:focus {
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
        }

        .file-info {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border-left: 4px solid #00ff88;
        }

        .file-path {
            font-family: monospace;
            color: #00ff88;
            font-size: 13px;
            margin-bottom: 5px;
        }

        .status {
            color: #888;
            font-size: 12px;
        }

        .status.success {
            color: #00ff88;
        }

        .status.error {
            color: #ff4444;
        }

        .stats-display {
            background: #1a1a1a;
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', Monaco, monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #ffffff;
            white-space: pre-wrap;
            min-height: 200px;
        }

        .stats-display:focus {
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
            outline: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 8px;
            padding: 15px;
        }

        .stat-label {
            color: #00ff88;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #ffffff;
            font-size: 18px;
            font-weight: 700;
        }

        .search-input {
            width: 100%;
            max-width: 300px;
            background: #1a1a1a;
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            padding: 12px 15px;
            color: #ffffff;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
            margin-right: 15px;
        }

        .search-input:focus {
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
        }

        .search-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
            .title {
                font-size: 2.5rem;
            }
            
            .container {
                padding: 15px;
            }
            
            .editor-section {
                padding: 20px;
            }
            
            .file-controls {
                flex-direction: column;
            }
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(0, 255, 136, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(0, 255, 136, 0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ADMIN</div>
            <h1 class="title">Control Panel</h1>
            <p class="subtitle">The ultimate admin interface for your database.</p>
            <p class="tagline">Premium management at its best</p>
        </div>

        <div class="stats-section">
            <h2 class="section-title">Player Stats Lookup</h2>
            
            <div class="search-controls">
                <input type="text" class="search-input" id="playerSearch" placeholder="Enter player username..." onkeypress="handleSearchKeypress(event)">
                <button class="btn" onclick="lookupPlayer()">Lookup Stats</button>
                <button class="btn btn-secondary" onclick="clearStats()">Clear</button>
            </div>

            <textarea class="stats-display" id="statsDisplay" readonly placeholder="Player stats will appear here after lookup..."></textarea>

            <div class="file-info">
                <div class="file-path">API: https://api.donutsmp.net/v1/stats/{user}</div>
                <div class="status" id="statsStatus">Enter a username to lookup player stats</div>
            </div>
        </div>

        <div class="editor-section">
            <h2 class="section-title">Database Editor</h2>
            
            <div class="file-controls">
                <button class="btn" onclick="loadFile()">Load File</button>
                <button class="btn" onclick="saveFile()">Save Changes</button>
                <button class="btn btn-secondary" onclick="clearEditor()">Clear</button>
                <button class="btn btn-secondary" onclick="downloadFile()">Download</button>
            </div>

            <textarea class="text-editor" id="editor" placeholder="Your database content will appear here. You can edit it directly and save changes."></textarea>

            <div class="file-info">
                <div class="file-path" id="filePath">File: /api/newusernamedatabase.txt</div>
                <div class="status" id="status">Ready to load file</div>
            </div>
        </div>
    </div>

    <script>
        const editor = document.getElementById('editor');
        const status = document.getElementById('status');
        const filePath = document.getElementById('filePath');
        const playerSearch = document.getElementById('playerSearch');
        const statsDisplay = document.getElementById('statsDisplay');
        const statsStatus = document.getElementById('statsStatus');
        
        // API Configuration
        const BASE_URL = 'https://star2likesgirls.github.io/databasedrycrash.github.io';
        const FILE_PATH = '/api/newusernamedatabase.txt';
        const DONUT_API = 'https://api.donutsmp.net/v1/stats';
        const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
        const API_KEY = '1af2ca54128a44234d953da1be7069c5'; // Your DonutSMP API key
        
        function updateStatus(message, type = '') {
            status.textContent = message;
            status.className = 'status ' + type;
        }

        async function loadFile() {
            try {
                updateStatus('Loading file...', '');
                document.body.classList.add('loading');
                
                const response = await fetch(BASE_URL + FILE_PATH);
                
                if (!response.ok) {
                    throw new Error(`Failed to load file: ${response.status} ${response.statusText}`);
                }
                
                const content = await response.text();
                editor.value = content;
                updateStatus(`File loaded successfully (${content.length} characters)`, 'success');
                
            } catch (error) {
                console.error('Error loading file:', error);
                updateStatus(`Error loading file: ${error.message}`, 'error');
            } finally {
                document.body.classList.remove('loading');
            }
        }

        function saveFile() {
            // Since we can't directly write to GitHub Pages files from the browser,
            // this will copy the content to clipboard and show instructions
            const content = editor.value;
            
            if (!content.trim()) {
                updateStatus('No content to save', 'error');
                return;
            }
            
            // Copy to clipboard
            navigator.clipboard.writeText(content).then(() => {
                updateStatus('Content copied to clipboard! Paste into your newusernamedatabase.txt file and commit to GitHub', 'success');
                
                // Show save instructions
                alert(`Content has been copied to your clipboard!\n\nTo save:\n1. Go to your GitHub repository\n2. Navigate to api/newusernamedatabase.txt\n3. Click Edit\n4. Paste the content (Ctrl+V)\n5. Commit changes\n\nYour changes will be live on GitHub Pages within a few minutes.`);
            }).catch(err => {
                updateStatus('Failed to copy to clipboard', 'error');
                console.error('Clipboard error:', err);
            });
        }

        function clearEditor() {
            if (confirm('Are you sure you want to clear all content?')) {
                editor.value = '';
                updateStatus('Editor cleared', 'success');
            }
        }

        function downloadFile() {
            const content = editor.value;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'newusernamedatabase.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            updateStatus('File downloaded', 'success');
        }
            statsStatus.textContent = message;
            statsStatus.className = 'status ' + type;
        }

        function updateStatsStatus(message, type = '') {
            statsStatus.textContent = message;
            statsStatus.className = 'status ' + type;
        }
            const username = playerSearch.value.trim();
            
            if (!username) {
                updateStatsStatus('Please enter a username', 'error');
                return;
            }

            try {
                updateStatsStatus('Looking up player stats...', '');
                console.log(`Looking up player: ${username}`);
                
                // Try direct request with proper Bearer token
                const response = await fetch(`${DONUT_API}/${username}`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    mode: 'cors'
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.log('Error response:', errorText);
                    
                    if (response.status === 401) {
                        throw new Error('Unauthorized - API Key may be invalid or expired');
                    } else if (response.status === 404) {
                        throw new Error('Player not found');
                    } else if (response.status === 429) {
                        throw new Error('Rate limit exceeded (250 requests/minute)');
                    } else {
                        throw new Error(`API Error: ${response.status} - ${errorText}`);
                    }
                }
                
                const data = await response.json();
                console.log('API Data:', data);
                displayPlayerStats(data, username);
                updateStatsStatus(`Stats loaded for ${username}`, 'success');
                
            } catch (error) {
                console.error('Full error:', error);
                
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    updateStatsStatus('CORS Error: Cannot connect to DonutSMP API from browser. API may not allow cross-origin requests.', 'error');
                    
                    // Show a helpful message about CORS
                    setTimeout(() => {
                        alert(`CORS Issue Detected!\n\nThe DonutSMP API doesn't allow requests from web browsers due to CORS policy.\n\nSolutions:\n1. Use a browser extension like "CORS Unblock"\n2. Test the API directly: https://api.donutsmp.net/v1/stats/${username}\n3. Use a backend service instead of client-side requests`);
                    }, 1000);
                    
                } else {
                    updateStatsStatus(`Error: ${error.message}`, 'error');
                }
                statsDisplay.value = `ERROR: ${error.message}\n\nTime: ${new Date().toLocaleString()}`;
            }
        }

        function displayPlayerStats(data, username) {
            let output = `=== PLAYER STATS FOR: ${username.toUpperCase()} ===\n\n`;
            
            if (data && typeof data === 'object') {
                // Display all stats in a clean text format
                for (const [key, value] of Object.entries(data)) {
                    if (value !== null && value !== undefined) {
                        const formattedKey = formatStatName(key).padEnd(25, '.');
                        const formattedValue = formatStatValue(value);
                        output += `${formattedKey} ${formattedValue}\n`;
                    }
                }
            } else {
                output += 'No stats data available for this player.\n';
            }
            
            output += `\n=== END OF STATS ===\nRetrieved: ${new Date().toLocaleString()}`;
            
            statsDisplay.value = output;
            updateStatsStatus(`Stats loaded for ${username}`, 'success');
        }

        function formatStatName(key) {
            return key
                .replace(/([A-Z])/g, ' $1')
                .replace(/^./, str => str.toUpperCase())
                .replace(/_/g, ' ');
        }

        function formatStatValue(value) {
            if (typeof value === 'number') {
                if (value >= 1000000) {
                    return (value / 1000000).toFixed(1) + 'M';
                } else if (value >= 1000) {
                    return (value / 1000).toFixed(1) + 'K';
                }
                return value.toLocaleString();
            }
            return value;
        }

        function clearStats() {
            statsDisplay.value = '';
            playerSearch.value = '';
            updateStatsStatus('Enter a username to lookup player stats', '');
        }

        function handleSearchKeypress(event) {
            if (event.key === 'Enter') {
                lookupPlayer();
            }
        }
            status.textContent = message;
            status.className = 'status ' + type;
        }

        async function loadFile() {
            try {
                updateStatus('Loading file...', '');
                document.body.classList.add('loading');
                
                const response = await fetch(BASE_URL + FILE_PATH);
                
                if (!response.ok) {
                    throw new Error(`Failed to load file: ${response.status} ${response.statusText}`);
                }
                
                const content = await response.text();
                editor.value = content;
                updateStatus(`File loaded successfully (${content.length} characters)`, 'success');
                
            } catch (error) {
                console.error('Error loading file:', error);
                updateStatus(`Error loading file: ${error.message}`, 'error');
            } finally {
                document.body.classList.remove('loading');
            }
        }

        function saveFile() {
            // Since we can't directly write to GitHub Pages files from the browser,
            // this will copy the content to clipboard and show instructions
            const content = editor.value;
            
            if (!content.trim()) {
                updateStatus('No content to save', 'error');
                return;
            }
            
            // Copy to clipboard
            navigator.clipboard.writeText(content).then(() => {
                updateStatus('Content copied to clipboard! Paste into your newusernamedatabase.txt file and commit to GitHub', 'success');
                
                // Show save instructions
                alert(`Content has been copied to your clipboard!\n\nTo save:\n1. Go to your GitHub repository\n2. Navigate to api/newusernamedatabase.txt\n3. Click Edit\n4. Paste the content (Ctrl+V)\n5. Commit changes\n\nYour changes will be live on GitHub Pages within a few minutes.`);
            }).catch(err => {
                updateStatus('Failed to copy to clipboard', 'error');
                console.error('Clipboard error:', err);
            });
        }

        function clearEditor() {
            if (confirm('Are you sure you want to clear all content?')) {
                editor.value = '';
                updateStatus('Editor cleared', 'success');
            }
        }

        function downloadFile() {
            const content = editor.value;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'newusernamedatabase.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            updateStatus('File downloaded', 'success');
        }

        // Auto-load file when page loads
        window.addEventListener('load', () => {
            loadFile();
        });

        // Save with Ctrl+S
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveFile();
            }
        });

        // Auto-save indicator
        let saveTimeout;
        editor.addEventListener('input', () => {
            clearTimeout(saveTimeout);
            updateStatus('Unsaved changes...', '');
            
            saveTimeout = setTimeout(() => {
                updateStatus('Content ready to save', '');
            }, 2000);
        });
    </script>
</body>
</html>
